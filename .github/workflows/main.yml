name: Odoo Reports Automation

on:
  workflow_dispatch:
    inputs:
      script_choice:
        description: "Select script to run"
        required: true
        default: "All"
        type: choice
        options:
          - All
          - Ot_data_fetch.py
          - purchase_orders_cleaned.py
      from_date:
        description: "Start date (YYYY-MM-DD)"
        required: false
        default: "2025-08-26"
      to_date:
        description: "End date (YYYY-MM-DD, leave empty for current date)"
        required: false
        default: ""

jobs:
  run_scripts:
    runs-on: ubuntu-latest
    env:
      ODOO_URL: ${{ secrets.ODOO_URL }}
      ODOO_DB: ${{ secrets.ODOO_DB }}
      ODOO_USERNAME: ${{ secrets.ODOO_USERNAME }}
      ODOO_PASSWORD: ${{ secrets.ODOO_PASSWORD }}
      GCREDS_BASE64: ${{ secrets.GOOGLE_CREDENTIALS_B64 }}
      FROM_DATE: ${{ github.event.inputs.from_date }}
      TO_DATE: ${{ github.event.inputs.to_date }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt || pip install requests pandas gspread gspread-dataframe google-auth pytz openpyxl

      - name: Decode Google Credentials
        run: |
          echo "$GCREDS_BASE64" | base64 --decode > gcreds.json

      - name: Run Selected Scripts
        run: |
          echo "Selected script: ${{ github.event.inputs.script_choice }}"
          if [ "${{ github.event.inputs.script_choice }}" = "All" ] || [ "${{ github.event.inputs.script_choice }}" = "Ot_data_fetch.py" ]; then
            echo "Running OT Data Fetch..."
            python Ot_data_fetch.py
          fi
          if [ "${{ github.event.inputs.script_choice }}" = "All" ] || [ "${{ github.event.inputs.script_choice }}" = "purchase_orders_cleaned.py" ]; then
            echo "Running Purchase Orders Fetch..."
            python purchase_orders_cleaned.py
          fi
